<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/favicon.png">
	<title>Admin | Paramètres</title>

	<meta name="description" content="">
	<meta name="author" content="Fahd Abdellaoui">

      <link rel="stylesheet" href="ionicons/css/ionicons.min.css" />
      <link rel="stylesheet" href="card/css/style.css">
        <script src="js/jquery-2.2.3.min.js"></script>



	<!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="assets/css/bootstrap/bootstrap.css" />

	<!-- Typeahead Styling  -->
    <link rel="stylesheet" href="assets/css/plugins/typeahead/typeahead.css" />

    <!-- TagsInput Styling  -->
    <link rel="stylesheet" href="assets/css/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css" />

    <!-- Chosen Select  -->
    <link rel="stylesheet" href="assets/css/plugins/bootstrap-chosen/chosen.css" />

    <!-- DateTime Picker  -->
    <link rel="stylesheet" href="assets/css/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.css" />

    <!-- Switch Buttons  -->
    <link rel="stylesheet" href="assets/css/switch-buttons/switch-buttons.css" />

    <!-- Fonts  -->
    <link href='../../../fonts.googleapis.com/css01fc.css?family=Raleway:400,500,600,700,300' rel='stylesheet' type='text/css'>

    <!-- Base Styling  -->
    <link rel="stylesheet" href="assets/css/app/app.v2.css" />
      <link href="/css/popup.css" rel="stylesheet" type="text/css" />
    <!--  Classes -->
    <script src="../models/client.ts"></script>
    <script src="../models/admin.ts"></script>
    <script src="../models/message.ts"></script>


    <!-- file upload settings-->

    <!-- file upload settings-->




</head>
<body>

  	<!-- popup-->
  	<div class="modal" id="modal_error" onclick="closePopup(this.id)">
    <div class="modal__box_error">
  		<center>
      <p id="modal_error_text"></p><br>
  		<button class="popupbtn">Bien j'ai compris</button>
  	</center>
    </div>
  </div>
  <!-- popup-->
  <!-- popup-->
  <div class="modal" id="modal_sucess" onclick="closePopup(this.id)">
  <div class="modal__box_sucess">
  	<center>
  	<p id="modal_sucess_text"></p><br>
  	<button class="popupbtn">Bien j'ai compris</button>
  </center>
  </div>
  </div>
  <!-- popup-->
  <!-- ********************************************************************Header starts***************************************************************** -->

	<!-- Preloader -->

  	<!-- Preloader -->
      <div class="loading-container">
        <div class="loading">
          <div class="l1">
            <div></div>
          </div>
          <div class="l2">
            <div></div>
          </div>
          <div class="l3">
            <div></div>
          </div>
          <div class="l4">
            <div></div>
          </div>
        </div>
      </div>
      <!-- Preloader -->

  	<aside class="left-panel">

              <div class="user text-center">
                <div id="avatar"></div>
                <h4 class="user-name" id="profilename">Administrateur</h4>

                    <div class="dropdown user-login">
                    <button class="btn btn-xs dropdown-toggle btn-rounded" type="button" data-toggle="dropdown" aria-expanded="true">
                      <i class="fa fa-circle status-icon available"></i>&nbsp; En ligne &nbsp;&nbsp;&nbsp; &nbsp;<i class="fa fa-angle-down"></i>
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                      <li role="presentation"><a role="menuitem" href="#" onClick="logout()"><i class="fa fa-circle status-icon signout"></i>&nbsp; Déconnexion</a></li>
                    </ul>
                    </div>
              </div>



              <nav class="navigation">
              	<ul class="list-unstyled">
                  	<li><a href="admin-home.html"><i class="glyphicon glyphicon-stats"></i><span class="nav-label">Tableau de bord</span></a></li>
  					</li>
            <li class="has-submenu"><a href="#"><i class="fa fa-toggle-on"></i> <span class="nav-label">Etat Site</span></a>
                      <ul class="list-unstyled">
                            <li><a href="admin-site.html">Mettre Hors Ligne</a></li>
                            <li><a href="#" onclick="siteonline()">Mettre En Ligne</a></li>
                        </ul>
                    </li>
  					<li><a href="admin-requests.html"><i class="fa fa-rotate-left"></i><span class="nav-label">Récupérations</span></a></li>
  					</li>
  					<li><a href="admin-messages.html"><i class="fa fa-wechat"></i><span class="nav-label">Messagerie</span></a></li>
  					</li>
  					<li><a href="admin-clients.html"><i class="fa fa-users"></i><span class="nav-label">Clients</span></a></li>
  					</li>
  					<li><a href="#" onClick="logout()"><i class="fa fa-power-off"></i><span class="nav-label">Déconnexion</span></a></li>
  					</li>

                  </ul>

              </nav>

      </aside>

      <section class="content">

          <header class="top-head container-fluid">


              <form role="search" class="navbar-left app-search pull-left hidden-xs">
                <input type="text" id="Skeyword" placeholder="Entrez les mots-clés..." class="form-control form-control-circle" onkeypress="handle(event)">
           	</form>

              <nav class=" navbar-default hidden-xs" role="navigation">
                  <ul class="nav navbar-nav">
                  <li><a href="admin-settings.html">Paramètres</a></li>
                </ul>
              </nav>

              <ul class="nav-toolbar">
              	<li class="dropdown"><a href="#" data-toggle="dropdown"><i class="fa fa-comments-o"></i> <span class="badge bg-warning" id="nbmsg"></span></a>
                  	<div class="dropdown-menu md arrow pull-right panel panel-default arrow-top-right messages-dropdown">
                          <div class="panel-heading">
                        	Messages
                          </div>

                          <div class="list-group" >


                            <div id="msgcontainer">
                            <!--messages here-->
                           </div>

                              <a href="admin-messages.html" class="btn btn-info btn-flat btn-block">Voir tous les messages</a>

                          </div>

                      </div>
                  </li>

              </ul>
          </header>


<!-- ********************************************************************Header Ends***************************************************************** -->
<style>
.invisible{
  display: none;
}
.boxi{
  position: relative;
  height: 800px;
  min-height: 800px;
  width: 100%;
  min-width: 800px;
  overflow: hidden;
  border: 0;
}
#profilename1{
color: #343847;
}

</style>




        <div class="warper container-fluid">





        <div class="container" style="width:100%;height:auto;">


<!-- work here -->
<div style="height:70px;"></div>
  <div class="row">
      <!-- begin col  -->
  <div class="col-lg-4 col-lg-offset-4">
      <div class="user text-center">
        <div id="avatar1"></div>
        <h4 class="user-name" id="profilename1">Administrateur</h4>
     </div>
        <hr class="clean">


            <form class="form-horizontal" role="form">
            <div class="form-group input-group">
            <span class="input-group-addon"><i class="fa fa-user"></i></span>
            <input type="text" id="prenom" class="form-control"  placeholder="Prenom">
            </div>
            <div class="form-group input-group">
            <span class="input-group-addon"><i class="fa fa-user"></i></span>
            <input type="text" id="nom_famille" class="form-control"  placeholder="Nom de famille">
            </div>
             <div class="form-group input-group">
            <span class="input-group-addon"><i class="fa fa-envelope"></i></span>
            <input type="email" id="email" class="form-control"  placeholder="Adresse Email">
            </div>
            <div class="form-group input-group">
            <span class="input-group-addon"><i class="fa fa-lock"></i></span>
            <input type="password" id="old-mdp" class="form-control"  placeholder="Mot de passe">
            </div>
            <hr>
             <div class="form-group input-group">
            <span class="input-group-addon"><i class="fa fa-lock"></i></span>
            <input type="password" id="new-mdp" class="form-control"  placeholder="Nouveau mot de passe">
            </div>
            <div class="form-group input-group">
             <span class="input-group-addon"><i class="fa fa-lock"></i></span>
             <input type="password" id="conf-mdp" class="form-control"  placeholder="Confirmer mot de passe">
             </div>
             <br>

               <button type="button" class="btn btn-info btn-block" onClick="update()">Valider</button><br>

                      </form>

                    </div>
                      <!-- end col  -->

                </div>
                <!-- end row  -->
<!-- work here -->



</div>
            </div>

<!-- ********************************************************************Script Starts***************************************************************** -->


          <script>


                $(window).load(function(){
                            try{
                              var session = localStorage.getItem('SPOT_ADMIN_SESSION');
                              if(session!="TRUE"){
                                alert("Session expiré");
                                document.location.href="/login.html";
                              }
                              else{
                                // initialize profile infos
                                loadprofileinfos();
                                loadmsgs();

                              }

                            }
                            catch(e){
                              document.location.href="/login.html";
                            }

                            });



                            function handle(e){

                                   if(e.keyCode === 13){
                                       e.preventDefault(); // Ensure it is only this code that rusn
                                       tosearch();
                                   }
                            }
                          function tosearch(){
                              var keyword=$('#Skeyword').val();
                              localStorage.setItem('spot_admin_serach_keyword',keyword);
                              document.location.href="/profile/admin-search.html";
                          }



                           setInterval(function(){
                             document.getElementById("msgcontainer").innerHTML="";
                               loadmsgs();
                             }, 10000)


                            function loadprofileinfos(){

                              var id = localStorage.getItem('spot_admin_id');
                              var name = localStorage.getItem('spot_admin_name');
                              var firstname = localStorage.getItem('spot_admin_firstname');
                              var lastname = localStorage.getItem('spot_admin_lastname');
                              var email = localStorage.getItem('spot_admin_email');
                              var currentpass = localStorage.getItem('spot_admin_currentpass');
                              var photo = localStorage.getItem('spot_admin_photo');
                              var statut = localStorage.getItem('spot_admin_statut');


                               A = new Admin(firstname,lastname,email,currentpass,photo,statut);
                               A.setId(id);
                                var prophoto=A.getPhoto();
                                document.getElementById("avatar").innerHTML='<img src="../img/'+prophoto+'.png" class="img-circle" alt="...">';
                                document.getElementById("avatar1").innerHTML='<img src="../img/'+prophoto+'.png" class="img-circle" alt="...">';

                                document.getElementById("prenom").value=A.getPrenom();
                                document.getElementById("nom_famille").value=A.getNom_famille();
                                document.getElementById("email").value=A.getEmail();


                            }

                            function loadmsgs(){
                            var id=A.getId();
                             var data = '{"operation":"select","table":"msgs","id":"'+id+'"}';
                             $.getJSON("/webapi.php",{client_req:data},showmsg);
                            }
                            function showmsg(json) {
                              if(json==null){
                                 document.getElementById("msgcontainer").innerHTML="<center>Boite message vide</center>";
                              }
                              else{
                                // all goood
                                Chat=[];
                               for (var i = 0; i < json.length; i++) {
                                 var Ami={"ami_id":json[i].c_id,
                                           "ami_prenom":json[i].prenom,
                                           "ami_nom_famille":json[i].nom_famille,
                                           "ami_photo":json[i].profilephoto,
                                           "ami_statut":json[i].statut
                                         }
                                         var exist=false;
                                         for (var j = 0; j < Chat.length; j++) {
                                           var a=JSON.stringify(Chat[j]);
                                           var b=JSON.stringify(Ami);

                                           if(a==b)
                                           {
                                              exist=true;
                                           }
                                         }
                                         if(exist==false){
                                           Chat.push(Ami);
                                         }

                                 }
                                 var ln=0;
                                 if(Chat.length>4){
                                   ln=4;
                                 }
                                 else{
                                   ln=Chat.length;
                                 }
                                 for (var k = 0; k < ln; k++) {
                                   var photo='../img/'+Chat[k].ami_photo+'.png'
                                   var completename=Chat[k].ami_prenom+' '+Chat[k].ami_nom_famille;
                                   var statut=Chat[k].ami_statut;
                                   if(k<=3){
                                     if(statut=="1"){
                                       //freind online
                                       document.getElementById("msgcontainer").innerHTML+='<a href="#" class="list-group-item"><div class="media"><div class="user-status online pull-left"><img class="media-object img-circle pull-left" src="'+photo+'" alt="user#1" width="40"></div><div class="media-body"><h5 class="media-heading"><b>'+completename+'</b><br><div id="lastmsg'+Chat[k].ami_id+'"></div></h5><small class="text-muted" id="Gtime'+Chat[k].ami_id+'"></small></div></div></a>';
                                     }
                                     else{
                                       //freind offline
                                       document.getElementById("msgcontainer").innerHTML+='<a href="#" class="list-group-item"><div class="media"><div class="user-status offline pull-left"><img class="media-object img-circle pull-left" src="'+photo+'" alt="user#1" width="40"></div><div class="media-body"><h5 class="media-heading"><b>'+completename+'</b><br><div id="lastmsg'+Chat[k].ami_id+'"></div></h5><small class="text-muted" id="Gtime'+Chat[k].ami_id+'"></small></div></div></a>';
                                     }
                                   }
                                for (var m = 0; m < json.length; m++) {
                                  if(Chat[k].ami_id==json[m].emetteur || Chat[k].ami_id==json[m].recepteur){
                                    var x = (new Date()).getTimezoneOffset() * 60000;
                                    var today= (new Date(Date.now() - x)).toISOString();
                                    $('#Gtime'+Chat[k].ami_id).html(msToTime((new Date(today)).valueOf() - (new Date(json[m].date)).valueOf()));
                                    $('#lastmsg'+Chat[k].ami_id).html(json[m].texte);
                                  }
                                }
                                }
                              }
                            if(Chat.length>0){
                              document.getElementById("nbmsg").innerHTML=""+Chat.length;
                            }

                            }

                            function msToTime(s){
                             var ms = s % 1000;
                             s = (s - ms) / 1000;
                             var secs = s % 60;
                             s = (s - secs) / 60;
                             var mins = s % 60;
                             var hrs = (s - mins) / 60;
                             if(hrs==0 && mins==0)
                                 return "à l'instant";
                             else if(hrs==0)
                                 return 'il y a '+mins+' minutes';
                             else if(hrs<24)
                                 return 'il y a '+hrs+' heures';
                             else
                                 return 'il y a '+Math.floor(hrs/24)+' jours';
                           }




                                           function update(){

                                         		var prenom = $("#prenom").val();
                                         		var nom_famille = $("#nom_famille").val();
                                            var email = $("#email").val();
                                         		var mdp = $("#old-mdp").val();
                                         		var newmdp = $("#new-mdp").val();
                                            var confmdp = $("#conf-mdp").val();
                                            var id=A.getId();
                                         		if(prenom==""||nom_famille==""||email==""){
                                             openPopup("modal_error","Tous les champs de base sont obligatoires !");
                                         		}
                                         		else if(mdp==""){
                                                 openPopup("modal_error","Le mot de passe est obligatoire !");
                                              }
                                            else if(mdp!=A.getMot_de_passe()){
                                              openPopup("modal_error","Mot de passe incorrecte !");
                                            }
                                            else{
                                              if(newmdp!="" || confmdp!=""){
                                                if(newmdp!=confmdp){
                                                   openPopup("modal_error","Les mots de passe ne sont pas identiques !");
                                                }
                                                else{
                                                  //update info + mdp
                                                  A.setPrenom(prenom);
                                                  A.setNom_famille(nom_famille);
                                                  A.setEmail(email);
                                                  A.setMot_de_passe(newmdp);
                                                  var data={
                                                     "operation":"update",
                                                     "table":"admin",
                                                     "id": A.getId(),
                                                     "prenom": A.getPrenom(),
                                                     "nom_famille": A.getNom_famille(),
                                                     "email":  A.getEmail(),
                                                     "password": A.getMot_de_passe()
                                                  }
                                                 var stdata=JSON.stringify(data);
                                                 $.getJSON("/webapi.php",{client_req:stdata},showconfirmproudatel);
                                                }
                                              }
                                              else{
                                                //update basic info only();
                                                A.setPrenom(prenom);
                                                A.setNom_famille(nom_famille);
                                                A.setEmail(email);
                                                var data={
                                                   "operation":"update",
                                                   "table":"admin",
                                                   "id": A.getId(),
                                                   "prenom": A.getPrenom(),
                                                   "nom_famille": A.getNom_famille(),
                                                   "email":  A.getEmail(),
                                                   "password": A.getMot_de_passe()
                                                }
                                               var stdata=JSON.stringify(data);
                                              //console.log(data);
                                               $.getJSON("/webapi.php",{client_req:stdata},showconfirmproudate);

                                              }


                                            }

                                           }
                                           function showconfirmproudatel(json) {
                                            if(json==null){
                                               openPopup("modal_error","Un problème est survenu, mise à jour annulé !");
                                            }
                                            else{
                                               openPopup("modal_sucess","Profil mis à jour avec succées !");
                                               setTimeout(() => {
                                               logout();
                                             }, 2000);

                                            }
                                          }
                                          function showconfirmproudate(json) {
                                           if(json==null){
                                              openPopup("modal_error","Un problème est survenu, mise à jour annulé !");
                                           }
                                           else{
                                              openPopup("modal_sucess","Profil mis à jour avec succées !");
                                              localStorage.setItem('spot_admin_name', A.getPrenom()+" "+A.getNom_famille());
                                              localStorage.setItem('spot_admin_firstname',A.getPrenom());
                                              localStorage.setItem('spot_admin_lastname', A.getNom_famille());
                                              localStorage.setItem('spot_admin_email', A.getEmail());
                                           }
                                         }













                                                                    // mettre le site en ligne
                                                                    function siteonline(){
                                                                      var data = '{"operation":"select","table":"site"}';
                                                                      $.getJSON("/webapi.php",{client_req:data},showsitestate);
                                                                    }
                                                                    function showsitestate(json) {
                                                                      if(json==null){
                                                                     openPopup("modal_error","Site déja en ligne !");
                                                                      }
                                                                      else{
                                                                        var data = '{"operation":"delete","table":"site"}';
                                                                        $.getJSON("/webapi.php",{client_req:data},showdelsitestate);
                                                                      }
                                                                    }
                                                                    function showdelsitestate(json) {
                                                                      if(json==null){
                                                                         openPopup("modal_error","Un problème est survenu !");
                                                                      }
                                                                      else{
                                                                         openPopup("modal_sucess","Votre site est en ligne !");
                                                                      }
                                                                    }
                                                                     // mettre le site en ligne







                              function openPopup(id,texte){
                              $('#'+id).addClass('visible');
                              $('#'+id+"_text").html(texte);
                              }
                              function closePopup(id){
                              $('#'+id).removeClass('visible');
                              }

                                  // fonction déconnexion du système
                               function logout(){

                                 localStorage.removeItem('SPOT_ADMIN_SESSION');
                                 localStorage.removeItem('spot_admin_id');
                                 localStorage.removeItem('spot_admin_name');
                                 localStorage.removeItem('spot_admin_firstname');
                                 localStorage.removeItem('spot_admin_lastname');
                                 localStorage.removeItem('spot_admin_email');
                                 localStorage.removeItem('spot_admin_currentpass');
                                 localStorage.removeItem('spot_admin_photo');
                                 localStorage.removeItem('spot_admin_statut');
                                 localStorage.removeItem('spot_selected_freind_id');
                                 getoffline("admin_offline",A.getId());

                               }
                               function getoffline(table,id){
                         				var offdata = {
                         					"operation": "update",
                         					"table": table,
                         					"id" :id
                         				 }
                         				 var stdata=JSON.stringify(offdata);
                          				 $.getJSON("/webapi.php",{client_req:stdata},showofflineconfirm);
                         			}
                         			function showofflineconfirm(json) {
                         			 if(json==null){
                         				 openPopup("modal_error","Problème de connexion, svp reconnecter vous !");
                         			 }
                         			 else{
                         					 document.location.href="/";
                         				 }
                         		 }


                            </script>
<!-- ********************************************************************Script Ends***************************************************************** -->


        <!-- Warper Ends Here (working area) -->


        <footer class="container-fluid footer">
        	<p>Copyright &copy; 2018. All Rights Reserved | A theme by <a href="https://www.linkedin.com/in/abdellaoui-fahed-74ba1ab8">Fahd Abdellaoui</a></p>
            <a href="#" class="pull-right scrollToTop"><i class="fa fa-chevron-up"></i></a>
        </footer>

    </section>
    <!-- Content Block Ends Here (right box)-->




    <script src="assets/js/plugins/underscore/underscore-min.js"></script>
    <!-- Bootstrap -->
    <script src="assets/js/bootstrap/bootstrap.min.js"></script>

    <!-- Globalize -->
    <script src="assets/js/globalize/globalize.min.js"></script>

    <!-- NiceScroll -->
    <script src="assets/js/plugins/nicescroll/jquery.nicescroll.min.js"></script>

    <!-- InputMask -->
    <script src="assets/js/plugins/inputmask/jquery.inputmask.bundle.js"></script>

    <!-- TagsInput -->
    <script src="assets/js/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js"></script>

    <!-- Custom JQuery -->
	<script src="assets/js/app/custom.js" type="text/javascript"></script>


</body>

<!-- Mirrored from freakpixels.com/portfolio/brio/forms-element.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 06 Oct 2017 22:13:55 GMT -->
</html>
